const CACHE_NAME="nintendo-news-v4",STATIC_CACHE="nintendo-news-static-v4",IMAGES_CACHE="nintendo-news-images-v4",RSS_CACHE="nintendo-news-rss-v4",CACHE_LIFETIMES={STATIC:2592e6,IMAGES:6048e5,RSS:3e5},STATIC_ASSETS=["./","./index.html","./index.prod.html","./styles/main.css?v=2.1","./styles/critical.css","./scripts/main.js?v=2.1","./scripts/main.min.js?v=2.1","./scripts/app-init.js","./scripts/app-init.min.js","./scripts/service-worker.min.js","./manifest.json","./browserconfig.xml","./images/favicon.ico","./images/favicon-16x16.png","./images/favicon-32x32.png","./images/icon-72x72.png","./images/icon-96x96.png","./images/icon-128x128.png","./images/icon-144x144.png","./images/icon-152x152.png","./images/icon-180x180.png","./images/icon-192x192.png","./images/icon-384x384.png","./images/icon-512x512.png","./images/icon-1024x1024.png"];function isCacheFresh(e,n){if(!e)return!1;const t=e.headers.get("sw-cache-time");return!!t&&Date.now()-parseInt(t)<n}function addCacheTimestamp(e){const n=new Headers(e.headers);return n.set("sw-cache-time",Date.now().toString()),new Response(e.body,{status:e.status,statusText:e.statusText,headers:n})}async function cleanupExpiredCache(){const e=[{name:STATIC_CACHE,maxAge:CACHE_LIFETIMES.STATIC},{name:IMAGES_CACHE,maxAge:CACHE_LIFETIMES.IMAGES},{name:RSS_CACHE,maxAge:CACHE_LIFETIMES.RSS}];for(const{name:n,maxAge:t}of e)try{const e=await caches.open(n),s=await e.keys();for(const n of s){const s=await e.match(n);s&&!isCacheFresh(s,t)&&await e.delete(n)}}catch(e){}}self.addEventListener("install",function(e){e.waitUntil(caches.open(STATIC_CACHE).then(function(e){return e.addAll(STATIC_ASSETS)}).catch(function(e){})),self.skipWaiting()}),self.addEventListener("activate",function(e){e.waitUntil(caches.keys().then(function(e){return Promise.all(e.map(function(e){if(!e.includes("v3"))return caches.delete(e)}))})),self.clients.claim()}),self.addEventListener("fetch",function(e){const n=e.request,t=new URL(n.url);STATIC_ASSETS.some(e=>n.url.endsWith(e))||n.url.match(/\/(styles\/.*\.css|scripts\/.*\.m?i?n?\.?js)(\?v=[\d.]+)?$/)?e.respondWith(caches.open(STATIC_CACHE).then(function(e){return e.match(n).then(function(t){return t&&isCacheFresh(t,CACHE_LIFETIMES.STATIC)?t:fetch(n).then(function(t){return 200===t.status&&e.put(n,addCacheTimestamp(t.clone())),t}).catch(function(){return t})})})):"image"===n.destination||t.pathname.match(/\.(jpg|jpeg|png|gif|webp|svg)$/i)?e.respondWith(caches.open(IMAGES_CACHE).then(function(e){return e.match(n).then(function(t){return t&&isCacheFresh(t,CACHE_LIFETIMES.IMAGES)?t:fetch(n).then(function(t){return 200===t.status&&e.put(n,addCacheTimestamp(t.clone())),t}).catch(function(){return t})})})):n.url.includes("corsproxy.io")||n.url.includes("codetabs.com")||n.url.includes("thingproxy.freeboard.io")||n.url.includes("allorigins.win")?e.respondWith(fetch(n).then(function(e){return 200===e.status&&caches.open(RSS_CACHE).then(function(t){t.put(n,addCacheTimestamp(e.clone()))}),e}).catch(function(){return caches.open(RSS_CACHE).then(function(e){return e.match(n)})})):e.respondWith(caches.match(n).then(function(e){return e||fetch(n)}))}),self.addEventListener("message",function(e){e.data&&"CLEAN_CACHE"===e.data.type&&cleanupExpiredCache()}),setInterval(()=>{cleanupExpiredCache()},36e5);