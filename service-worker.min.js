const CACHE_NAME="nintendo-news-v4",STATIC_CACHE="nintendo-news-static-v4",IMAGES_CACHE="nintendo-news-images-v4",RSS_CACHE="nintendo-news-rss-v4",CACHE_LIFETIMES={STATIC:2592e6,IMAGES:6048e5,RSS:3e5},STATIC_ASSETS=["./","./index.html","./index.prod.html","./styles/main.css?v=2.1","./styles/critical.css","./scripts/main.js?v=2.1","./scripts/main.min.js?v=2.1","./scripts/app-init.js","./scripts/app-init.min.js","./scripts/service-worker.min.js","./manifest.json","./browserconfig.xml","./images/favicon.ico","./images/favicon-16x16.png","./images/favicon-32x32.png","./images/icon-72x72.png","./images/icon-96x96.png","./images/icon-128x128.png","./images/icon-144x144.png","./images/icon-152x152.png","./images/icon-180x180.png","./images/icon-192x192.png","./images/icon-384x384.png","./images/icon-512x512.png","./images/icon-1024x1024.png"];function isCacheFresh(n,e){if(!n)return!1;const t=n.headers.get("sw-cache-time");return!!t&&Date.now()-parseInt(t)<e}async function addCacheTimestamp(n){const e=await n.blob(),t=new Headers(n.headers);return t.set("sw-cache-time",Date.now().toString()),new Response(e,{status:n.status,statusText:n.statusText,headers:t})}async function cleanupExpiredCache(){const n=[{name:STATIC_CACHE,maxAge:CACHE_LIFETIMES.STATIC},{name:IMAGES_CACHE,maxAge:CACHE_LIFETIMES.IMAGES},{name:RSS_CACHE,maxAge:CACHE_LIFETIMES.RSS}];for(const{name:e,maxAge:t}of n)try{const n=await caches.open(e),s=await n.keys();for(const e of s){const s=await n.match(e);s&&!isCacheFresh(s,t)&&await n.delete(e)}}catch(n){}}self.addEventListener("install",function(n){n.waitUntil(caches.open(STATIC_CACHE).then(function(n){return n.addAll(STATIC_ASSETS)}).catch(function(n){})),self.skipWaiting()}),self.addEventListener("activate",function(n){n.waitUntil(caches.keys().then(function(n){return Promise.all(n.map(function(n){if(!n.includes("v3"))return caches.delete(n)}))})),self.clients.claim()}),self.addEventListener("fetch",function(n){const e=n.request,t=new URL(e.url);STATIC_ASSETS.some(n=>e.url.endsWith(n))||e.url.match(/\/(styles\/.*\.css|scripts\/.*\.m?i?n?\.?js)(\?v=[\d.]+)?$/)?n.respondWith(caches.open(STATIC_CACHE).then(async function(n){return n.match(e).then(async function(t){return t&&isCacheFresh(t,CACHE_LIFETIMES.STATIC)?t:fetch(e).then(async function(t){return 200===t.status&&n.put(e,await addCacheTimestamp(t.clone())),t}).catch(function(){return t})})})):"image"===e.destination||t.pathname.match(/\.(jpg|jpeg|png|gif|webp|svg)$/i)?n.respondWith(caches.open(IMAGES_CACHE).then(async function(n){return n.match(e).then(async function(t){return t&&isCacheFresh(t,CACHE_LIFETIMES.IMAGES)?t:fetch(e).then(async function(t){return 200===t.status&&n.put(e,await addCacheTimestamp(t.clone())),t}).catch(function(){return t})})})):e.url.includes("corsproxy.io")||e.url.includes("codetabs.com")||e.url.includes("thingproxy.freeboard.io")||e.url.includes("allorigins.win")?n.respondWith(fetch(e).then(async function(n){return 200===n.status&&caches.open(RSS_CACHE).then(async function(t){t.put(e,await addCacheTimestamp(n.clone()))}),n}).catch(function(){return caches.open(RSS_CACHE).then(function(n){return n.match(e)})})):n.respondWith(caches.match(e).then(function(n){return n||fetch(e)}))}),self.addEventListener("message",function(n){n.data&&"CLEAN_CACHE"===n.data.type&&cleanupExpiredCache()}),setInterval(()=>{cleanupExpiredCache()},36e5);